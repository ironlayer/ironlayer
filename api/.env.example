# =============================================================================
# IronLayer API — Environment Variables
# =============================================================================
#
# Copy to .env and customise. Settings vars use the API_ prefix.
# Auth/security vars (JWT_SECRET, AUTH_MODE) are unprefixed — they are
# read directly in middleware/auth.py, not via Pydantic settings.
#
#   cp .env.example .env
#
# See api/api/config.py (APISettings) for settings reference and
# api/api/middleware/auth.py (_build_token_config) for auth reference.
# =============================================================================

# --- Server ------------------------------------------------------------------
API_HOST=0.0.0.0
API_PORT=8000
API_DEBUG=false

# --- Database ----------------------------------------------------------------
# PostgreSQL connection string (asyncpg driver).
API_DATABASE_URL=postgresql+asyncpg://ironlayer:ironlayer_dev@localhost:5432/ironlayer

# --- AI Engine ---------------------------------------------------------------
API_AI_ENGINE_URL=http://localhost:8001
API_AI_ENGINE_TIMEOUT=10.0
# Shared secret for authenticating requests to the AI engine (must match
# the AI engine's AI_ENGINE_SHARED_SECRET value).
# AI_ENGINE_SHARED_SECRET=<secret>

# --- Environment -------------------------------------------------------------
# dev | staging | production — controls approval gate behaviour.
API_PLATFORM_ENV=dev

# --- CORS --------------------------------------------------------------------
# Comma-separated list of allowed origins.
API_CORS_ORIGINS=["http://localhost:3000"]

# --- Rate Limiting -----------------------------------------------------------
API_RATE_LIMIT_ENABLED=true
API_RATE_LIMIT_REQUESTS_PER_MINUTE=60
API_RATE_LIMIT_BURST_MULTIPLIER=1.5
API_RATE_LIMIT_AUTH_ENDPOINTS_PER_MINUTE=20

# --- Token Revocation -------------------------------------------------------
API_TOKEN_REVOCATION_ENABLED=true

# --- Authentication & JWT (no API_ prefix) ------------------------------------
# AUTH_MODE controls how tokens are generated and validated.
# Supported modes: development | jwt | kms_exchange | oidc_onprem
#
#   development — insecure default secret; DO NOT use in production.
#   jwt         — HMAC-signed JWTs using JWT_SECRET. Recommended for SaaS.
#   kms_exchange — Envelope encryption via AWS KMS or Azure Key Vault.
#   oidc_onprem — Validate tokens from an external OIDC provider (enterprise SSO).
#
# IMPORTANT: In production, set AUTH_MODE=jwt and provide a strong JWT_SECRET.
# The API will REFUSE TO START if AUTH_MODE is not "development" and JWT_SECRET
# is unset.
AUTH_MODE=development
# JWT_SECRET=<64+ char high-entropy secret — generate with: openssl rand -base64 64>
# JWT_ALGORITHM=HS256
# TOKEN_TTL_SECONDS=3600
# REFRESH_TOKEN_TTL_SECONDS=86400

# --- KMS (only for kms_exchange mode) ----------------------------------------
# KMS_KEY_ARN=arn:aws:kms:... or https://<vault>.vault.azure.net/keys/<name>

# --- OIDC (only for oidc_onprem mode) ----------------------------------------
# OIDC_ISSUER_URL=https://login.microsoftonline.com/<tenant-id>/v2.0
# OIDC_AUDIENCE=api://ironlayer

# --- Security ----------------------------------------------------------------
API_ALLOWED_REPO_BASE=/workspace

# --- Logging -----------------------------------------------------------------
# Set true for JSON structured logging (SIEM integration).
API_STRUCTURED_LOGGING=false

# --- Stripe Billing (optional) ----------------------------------------------
API_BILLING_ENABLED=false
# API_STRIPE_SECRET_KEY=sk_test_...
# API_STRIPE_WEBHOOK_SECRET=whsec_...
# API_STRIPE_PRICE_ID_COMMUNITY=price_...
# API_STRIPE_PRICE_ID_TEAM=price_...
# API_STRIPE_PRICE_ID_ENTERPRISE=price_...
# API_STRIPE_METERED_PRICE_ID=price_...
# API_STRIPE_PRICE_ID_PER_SEAT=price_...
